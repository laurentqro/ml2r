<%= turbo_stream_from "adverse_media_check_#{adverse_media_check.id}_updates" %>

<%= turbo_frame_tag "adverse_media_check_#{adverse_media_check.id}" do %>
  <div class="card bg-base-200 mb-4">
    <div class="card-body">
      <div class="flex justify-between items-start">
        <div>
          <% if adverse_media_check.in_progress? %>
            <div class="flex items-center mb-2">
              <div class="loading loading-spinner loading-xs text-primary mr-2"></div>
              <span class="text-xs text-primary">Check in progress ...</span>
            </div>
          <% else %>
            <div class="flex items-center mb-2">
              <span class="badge <%= adverse_media_check.completed? ? 'badge-success' : 
                (adverse_media_check.failed? ? 'badge-error' : 'badge-warning') %>">
                Check <%= adverse_media_check.status %>
              </span>
            </div>
          <% end %>

          <div class="font-medium">
            <span class="<%= adverse_media_check.adverse_media_status == 'Adverse Media Found' ? 'text-error' : 'text-success' %>">
              <%= adverse_media_check.adverse_media_status %>
            </span>
          </div>

          <div class="text-sm text-base-content/60">
            <%= adverse_media_check.created_at.strftime("%d %B %Y %H:%M:%S") %>
          </div>
        </div>

        <% if adverse_media_check.completed? %>
          <button type="button" 
                  class="btn btn-link btn-sm"
                  onclick="toggleDetails('<%= dom_id(adverse_media_check) %>')">
            View Details
          </button>
        <% end %>
      </div>

      <% if adverse_media_check.completed? %>
        <div id="<%= dom_id(adverse_media_check) %>_details" class="mt-4 hidden">
          <div class="bg-base-100 p-3 rounded-box border">
            <%= render "adverse_media_checks/result", adverse_media_check: adverse_media_check %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <script>
    function toggleDetails(id) {
      const detailsElement = document.getElementById(id + '_details');
      if (detailsElement.classList.contains('hidden')) {
        detailsElement.classList.remove('hidden');
      } else {
        detailsElement.classList.add('hidden');
      }
    }
  </script>
<% end %>